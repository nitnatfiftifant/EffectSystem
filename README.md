# Демонстрация системы эффектов.
**Эффекты** - сущности которые выполняют разнообразный функционал. Нужна по сути для создания независимых от другого кода возможностей.
Например есть эффект огня, который наносит урон своей цели и создаёт визуал огня на ней, но это не всё что он может. Во первых все эффекты имеют свой жизненный цикл, можно применять его сразу один раз, можно вызывать его какое-то время, а можно сделать его пассивкой.

>## Зачем?
>Ну для чего нужен жизненный цикл у определённого эффекта понятно, например для способностей и заклинаний. Но изначально концепция возникла из нужды в применение уникальных предметов игроком, которые помимо того, что просто влияют на его аттрибуты, они должны иметь
>определённое поведение и даже менять геймплей. Например создать временный баф оказалось проблематично, просто меняя параметры, нужна сущность которое отслеживает нужные события и реагирует на них.

### Для лучшего понимания приведу структуру системы:
1. Для удобства, эффекты можно применять только к Entiti - класс отвечающий за игроков, врагов, NPC, интерактивные объекты и прочее.
  > Класс наследуется от CharacterBody3D, но не думаю что это ограничивает примененние эффектов для нужных мне целей
2. У Entiti должен быть дочерний узел EffectManager, который является интерфейсом между эффектами и Entiti. По совместительству является и хранилищем наложенных на Entiti эффектов. EffectManager это Node, который используется другими объектами для создания в нём эффектов
  > Возможно стоит использовать глобальный менеджер для всех эффектов, отделив их от своих целей. Но пока я не вижу проблем в том, что он находится в дереве узлов Entiti
3. Какое-то событие(вообще без разницы) получает ссылку на цель(Entiti) и создаёт через его EffectManager нужный эффект функцией add_effect ссылкой на нужный эффект и с массивом targets(объясняется ниже) 
  > Для удобства используется автозагрузка EffectDb, которое содержит словарь-перечисление всех путей к эффектам в проекте. Не думаю, что это создаст проблем
4. Эффект инстанцируется в EffectManager и запускает свой цикл, для большей функциональности, есть функции принимающие сигналы эффектов
5. Эффект или Effect, реализован как узел Node, который имеет свой жизненный цикл и параметры для его поведения приминения, но сам по себе ничего не делает
6.Для каждого уникального эффекта создаётся скрипт, расширяющий Effect переопределяя базовые функции и вызывая общую реализацию, для последовательного поведения
  > Именнование отдельных классов для каждого эффекта не нужно. Также нужно вызывать базовую реализацию той же функции, для общего поведения через super
7. Эффект делает что-то на тех стадиях жизненного цикла которые нужны.

### Дерево эффектов
  - Мир
    - Enititi
      - EffectManager
        - FireEffect  
        - HealEffect
        - FlyEffect
        - ...
        - InvisibleEffect

На данный момент реализованна только цепочка эффектов Fire -> FireExplosion -> Fire...
В данный момент продолжается проработка удобной гибкой системы последовательных эффектов, а также их взаимодействие
